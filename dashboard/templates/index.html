<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WKF Finance Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¤– WKF Finance Dashboard</h1>
            <p class="subtitle">AI ê¸°ë°˜ ê³µì‹œ ë¶„ì„ ë° ìë™ ë§¤ë§¤ ì‹œìŠ¤í…œ</p>
        </header>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">ì´ ê³µì‹œ ìˆ˜</div>
                <div class="stat-value">{{ stats.total_disclosures }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì˜¤ëŠ˜ ê³µì‹œ</div>
                <div class="stat-value">{{ stats.today_disclosures }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì´ ë¶„ì„ ìˆ˜</div>
                <div class="stat-value">{{ stats.total_analyses }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì§„í–‰ ì¤‘ì¸ ê±°ë˜</div>
                <div class="stat-value">{{ stats.active_trades }}</div>
            </div>
        </div>

        <!-- LLM ì„±ê³¼ ìš”ì•½ -->
        {% if performance %}
        <section class="performance-section">
            <h2>ğŸ“Š LLM ëª¨ë¸ë³„ ì„±ê³¼</h2>
            <table class="performance-table">
                <thead>
                    <tr>
                        <th>ëª¨ë¸</th>
                        <th>ì´ ê±°ë˜</th>
                        <th>ìŠ¹</th>
                        <th>íŒ¨</th>
                        <th>ìŠ¹ë¥ </th>
                        <th>í‰ê·  ROI</th>
                        <th>ì´ ìˆ˜ìµ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for perf in performance %}
                    <tr>
                        <td><span class="llm-badge llm-{{ perf.llm_model }}">{{ perf.llm_model }}</span></td>
                        <td>{{ perf.total_trades }}</td>
                        <td class="text-success">{{ perf.wins }}</td>
                        <td class="text-danger">{{ perf.losses }}</td>
                        <td>{{ perf.win_rate }}%</td>
                        <td class="{% if perf.avg_roi > 0 %}text-success{% else %}text-danger{% endif %}">
                            {{ perf.avg_roi }}%
                        </td>
                        <td class="{% if perf.total_profit > 0 %}text-success{% else %}text-danger{% endif %}">
                            {{ "{:,}".format(perf.total_profit) }} ì›
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
        {% endif %}

        <!-- ë‚ ì§œ í•„í„° -->
        <section class="filter-section">
            <h2>ğŸ“… ê³µì‹œ ì¡°íšŒ</h2>
            <form method="get" class="date-filter">
                <label>
                    ì‹œì‘ ë‚ ì§œ:
                    <input type="date" name="start_date" value="{{ start_date }}" required>
                </label>
                <label>
                    ì¢…ë£Œ ë‚ ì§œ:
                    <input type="date" name="end_date" value="{{ end_date }}" required>
                </label>
                <button type="submit">ì¡°íšŒ</button>
            </form>
        </section>

        <!-- ê³µì‹œ ëª©ë¡ -->
        <section class="disclosures-section">
            <h2>ğŸ“„ ê³µì‹œ ëª©ë¡ ({{ disclosures|length }}ê±´)</h2>

            {% if disclosures %}
                {% for disclosure in disclosures %}
                <div class="disclosure-card">
                    <div class="disclosure-header">
                        <div class="disclosure-title">
                            <h3>{{ disclosure.corp_name }} ({{ disclosure.stock_code or 'N/A' }})</h3>
                            <span class="disclosure-date">{{ disclosure.rcept_dt[:4] }}-{{ disclosure.rcept_dt[4:6] }}-{{ disclosure.rcept_dt[6:] }}</span>
                        </div>
                        <div class="disclosure-meta">
                            <span class="badge">{{ disclosure.report_nm }}</span>
                        </div>
                    </div>

                    <div class="disclosure-info">
                        <strong>ê³µì‹œ ìœ í˜•:</strong> {{ disclosure.report_nm }}
                        {% if disclosure.flr_nm %}
                        <br><strong>ì‹ ê³ ì¸:</strong> {{ disclosure.flr_nm }}
                        {% endif %}
                    </div>

                    <!-- ì¢…ëª© ì¶”ì²œ -->
                    {% if disclosure.recommendations %}
                    <div class="recommendations-section">
                        <h4>ğŸ¯ LLM ì¶”ì²œ ì¢…ëª©</h4>
                        <div class="recommendations-grid">
                            {% for rec in disclosure.recommendations %}
                            <div class="recommendation-card">
                                <div class="rec-header">
                                    <span class="llm-badge llm-{{ rec.llm_model }}">{{ rec.llm_model }}</span>
                                    <span class="stock-info">{{ rec.stock_name }} ({{ rec.stock_code }})</span>
                                </div>
                                {% if rec.reasoning %}
                                <p class="rec-reasoning">{{ rec.reasoning[:200] }}{% if rec.reasoning|length > 200 %}...{% endif %}</p>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- LLM ë¶„ì„ ê²°ê³¼ -->
                    {% if disclosure.analyses %}
                    <div class="analyses-section">
                        <h4>ğŸ¤– LLM ë¶„ì„ ê²°ê³¼</h4>
                        <div class="analyses-grid">
                            {% for analysis in disclosure.analyses %}
                            <div class="analysis-card">
                                <div class="analysis-header">
                                    <span class="llm-badge llm-{{ analysis.llm_model }}">{{ analysis.llm_model }}</span>
                                    <span class="stock-info">{{ analysis.stock_name or analysis.stock_code }}</span>
                                </div>

                                <div class="analysis-probability">
                                    <div class="prob-label">í™•ë¥ </div>
                                    <div class="prob-value prob-{{ 'high' if analysis.probability >= 70 else 'medium' if analysis.probability >= 50 else 'low' }}">
                                        {{ analysis.probability }}%
                                    </div>
                                </div>

                                <div class="analysis-prices">
                                    {% if analysis.target_price %}
                                    <div class="price-item">
                                        <span class="price-label">ëª©í‘œê°€:</span>
                                        <span class="price-value">{{ "{:,}".format(analysis.target_price) }}ì›</span>
                                    </div>
                                    {% endif %}
                                    {% if analysis.stop_loss %}
                                    <div class="price-item">
                                        <span class="price-label">ì†ì ˆê°€:</span>
                                        <span class="price-value">{{ "{:,}".format(analysis.stop_loss) }}ì›</span>
                                    </div>
                                    {% endif %}
                                </div>

                                {% if analysis.reasoning %}
                                <div class="analysis-reasoning">
                                    <strong>ë¶„ì„ ê·¼ê±°:</strong>
                                    <p>{{ analysis.reasoning[:300] }}{% if analysis.reasoning|length > 300 %}...{% endif %}</p>
                                </div>
                                {% endif %}

                                <!-- ê±°ë˜ ì •ë³´ -->
                                {% if analysis.holding %}
                                <div class="holding-info">
                                    <div class="holding-status status-{{ analysis.holding.status }}">
                                        {{ {'pending': 'ëŒ€ê¸°ì¤‘', 'bought': 'ë³´ìœ ì¤‘', 'sold': 'ë§¤ë„ì™„ë£Œ'}[analysis.holding.status] }}
                                    </div>
                                    {% if analysis.holding.quantity %}
                                    <div class="holding-details">
                                        <span>ìˆ˜ëŸ‰: {{ analysis.holding.quantity }}</span>
                                        {% if analysis.holding.average_price %}
                                        <span>í‰ê· ê°€: {{ "{:,}".format(analysis.holding.average_price) }}ì›</span>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <p>ì„ íƒí•œ ë‚ ì§œ ë²”ìœ„ì— ê³µì‹œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
            {% endif %}
        </section>

        <footer>
            <p>ğŸ¤– Generated with Claude Code | Last updated: {{ stats.total_disclosures }} disclosures</p>
        </footer>
    </div>
</body>
</html>
